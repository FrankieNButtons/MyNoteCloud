# <center>操作系统课堂笔记</center>


## Chap1：操作系统概论
### 计算机的启动
 - 引导程序（Bootstrap Program）
    1. 存储在**固件**中（ROM或EPROM）
    2. 
    3. 
### 操作系统的功能


### 操作系统的历史（共5代）
 - **第一代**：ENIAC（十进制，纸带存储，无操作系统，真空管计算机）

 - **第三代**：集成电路（多道程序批处理系统，仍为批处理系统，但已有分时系统设计的思想）
 - **第四代**：

### 操作系统的分类
 - 批处理系统：
 - 交互式系统：
 - 分时系统：
 - 分布式系统：
 - 实时系统：


### 计算机系统的组成



#### “特权”机制
 - 将指令分为**特权指令**和**非特权指令**

#### “状态位”机制（寄存器内）
 - 用于确定调用资源的权限
 - 仅一位，用于区分**用户模式**和**内核模式**


### 存储结构
#### 基本硬件
 - 内存：CPU唯一能直接访问的大容量存储区域
 - 告诉缓存：CPU-内存体系中的结构内辅助存储，用于匹配CPU速度和内存访问速度
 - 外部存储器：用于扩展内存存储能力，甚至具有冷存储功能的大容量存储器。
#### 中断（外中断）机制
 - 原因：由外部设备完成某些操作后发送给CPU的指令，需要硬件支持引起，是异步执行的结果。
 - 触发：当CPU执行程序时，发生错误，如**指令

#### 陷阱（内中断）机制
 - 原因：通常由于CPU执行程序时出现内部错误而引起
 - 触发：当CPU执行程序时，发生错误，如

## Chap2：操作系统的体系结构
### OS的定义
 - 操作系统是一个**软件**
 - 操作系统是一个**资源分配器** 
    *主要功能：*
    1. 管理所有计算机资源
    2. 处理冲突请求，公平地为用户和程序分配资源
 - 操作系统是一个**控制程序**
    1. 控制程序执行防止出错
    2. 控制各种I/O防止资源不当使用（如可以实现**外设并行**）
 - 操作系统是**一直处在运行状态的程序**，其中一直在内存中运行的部分叫**内核**，其余称**系统程序**，非操作系统的程序则为**应用程序**。
 - 不同操作系统的内核**基本功能模块设计**有所不同。
**备注**：一些嵌入式操作系统或基于解释型语言构建的操作系统是**没有内核态**，不在本课程讨论之列。

### 并发 vs. 并行
- 并发：在同一设备上同时运行多个程序（如**单个单核单线程**CPU），不同程序的指令有乱序执行导致一些意外错误，因此操作系统也需要将“共享变量”视为一种资源进行管理，因此操作系统往往引入**同步机制**以保证必要指令不乱序执行以避免影响共享变量出错。

### 操作系统结构




#### 内核设计理念不同
 - **微内核**：内核小、常驻内存少，系统程序易于扩展，用户软件资源利用率相对高，但可靠性低，且效率较低（以Windows为典型）；
 - **强内核**：内核大，常驻内存多，扩展性差，用户应用软件资源利用率低，但可靠性高，且效率高（以Linux为典型）；

### 经典案例分析
#### 有限缓存与共享内存的实现（生产者/消费者模型）
```
while (true) {

}
```

## Chap3：进程
### 进程的一些概念与特点
#### 进程的状态
 - 创建态：`创建进程`后，进程处于`创建态`，直到`进程除CPU外的资源分配完毕`后转入`就绪态`。
 - 就绪态：`除CPU外的资源全部就绪`的进程状态。
    - 进出条件：转入`运行态`
 - 运行态：进程得到CPU资源并执行的状态。
    - 进入条件1：`根据操作系统调度策略分配得到CPU资源`后转为`运行态`。
    - 转出条件1：
    - 转出条件2：`单次运行定时器结束`、`时间片`、`进程资源被更高优先级（或其他调度原因，如参数指定或当前进程自愿）引起进程被抢占`后转`就绪态`
    - **备注**：抢占是系统调度的进程外部行为。
    - 转出条件3：`CPU执行完毕`转为`终止态`。
 - 等待态（阻塞态）：
    - 进入条件：需要`等待某事件`或`数据I/O`而转为`运行态`。
    - 转出条件：`转入条件结束后`从`等待态`转入`就绪态`。
    - **备注**：`阻塞`是进程本身的进程内部行为。
   - 终止态：进程执行完毕，由`运行态`进入`终止态`。
#### 
### 进程控制块PCB
![PCB结构示意图](images/image.png)
### 进程调度
按阶段分类：  
 - `长期调度程序（作业调度）`：从存储设备的缓冲池中选择进程，并将它们装入内存（新建进程）以执行。（将作业加入作业队列，几秒到几分钟）
 - `短期调度程序（CPU调度）`：从内存中就绪可执行的进程中选择进程，并为其中之一分配CPU。可能只需要几毫秒
 - `中期调度程序`：运行中的进程如果出现了资源不足，可能会抽调部分运行中进程的资源后重新分配。
调度策略不同：  
 - `长期调度策略`：原则是`维持系统稳定`，即合理搭配系统中CPU为主的进程和`I/O为主`的进程。（算法也相对复杂，总体上要考虑所有系统资源）
 - `中期调度策略（图解）`：
   ![中期调度图解](images/image-1.png)
 - 
### 上下文切换
 - **定义**：将CPU切换到另一个进程时需要保存原有进程的状态（PCB），同时装入新进程的保存状态。这一过程称为上下文切换。
 - **特点**：上下文切换时系统不做其他工作，花费的时间是系统的额外开销，时间长短与硬件支持密切相关，通常为微秒级（1us-1000$\mu$s）

### 经典案例：”生产者-消费者“模型

### 进程间通信（IPC）

## Chap4：线程
### 与进程的区别定义
- **线程**：进程的子集，是**进程的轻量级**，线程可以共享进程的资源，是`最小的执行单位`。
- **进程**：**进程是**`资源分配的最小单位`，是**进程的完整状态**，切换的效率**不如线程**。
### 多线程的优点
 - `响应度高`
 - `资源共享`
 - `经济性高`
 - 充分利用`多处理器`体系结构
### 线程的分类
 - `用户线程`：同一进程的线程切换是进程内部的性能开销，不属于`操作系统的性能开销`，只有`不同进程间`的线程切换才属于，同时对操作系统而言就是进程切换调度。
 - `内核线程`：操作系统以线程为单位进行资源调度，原理同进程调度。

## Chap9: 
### “局部”现象
#### ”置换“
## Chap13：I/O系统
### 存储管理

#### DMA机制
 - 原理：直接在内存中开辟空间，不经过CPU缓存，以减少触发CPU中断机制。
 - 条件：只有**快设备**才能进行
 - 功能：全部磁盘传输完了再进行**DMA中断**，可以大大减少中断次数（原本是1Byte一次中断）。
